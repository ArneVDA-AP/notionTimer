<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual Timer for Notion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            color: #E0E1DD;
            height: 100vh;
            overflow: hidden;
        }
        .font-roboto-mono {
            font-family: 'Roboto Mono', monospace;
        }
        .btn-focus:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(119, 141, 169, 0.5);
        }
        /* Active tab style */
        .tab-button.active {
            border-color: #E0E1DD; /* Or another contrasting color from your palette */
            font-weight: 600; /* semibold */
        }
    </style>
</head>
<body class="bg-[#191919] flex flex-col items-center justify-center p-4 antialiased">

    <div class="bg-[#1B263B] p-6 sm:p-10 rounded-xl shadow-2xl w-full max-w-2xl">
        <!-- Tabs -->
        <div class="mb-6 flex border-b border-[#415A77]">
            <button id="workTabButton" data-tab="work" class="tab-button py-3 px-6 text-lg text-[#E0E1DD] border-b-2 border-transparent hover:border-[#778DA9] focus:outline-none transition-colors duration-150">Work</button>
            <button id="breakTabButton" data-tab="break" class="tab-button py-3 px-6 text-lg text-[#E0E1DD] border-b-2 border-transparent hover:border-[#778DA9] focus:outline-none transition-colors duration-150">Break</button>
        </div>

        <!-- Timer Content Panes -->
        <div id="workTimerContent" class="timer-content">
            <div id="workTimeDisplay" class="text-6xl sm:text-8xl font-roboto-mono mb-10 sm:mb-12 text-center text-[#E0E1DD] py-4 bg-[#415A77]/30 rounded-lg">
                00:00:00
            </div>
            <div class="flex flex-col sm:flex-row justify-around space-y-4 sm:space-y-0 sm:space-x-4">
                <button id="workStartButton" class="bg-[#415A77] hover:bg-[#5a768a] active:bg-[#354a60] text-[#E0E1DD] font-semibold py-3 sm:py-4 px-4 rounded-lg text-lg sm:text-xl w-full sm:w-1/3 transition duration-150 ease-in-out btn-focus">
                    Start
                </button>
                <button id="workStopButton" class="bg-[#778DA9] hover:bg-[#93a5bd] active:bg-[#60738a] text-[#0D1B2A] font-semibold py-3 sm:py-4 px-4 rounded-lg text-lg sm:text-xl w-full sm:w-1/3 transition duration-150 ease-in-out btn-focus" disabled>
                    Stop
                </button>
                <button id="workResetButton" class="bg-transparent hover:bg-[#415A77]/30 active:bg-[#415A77]/50 border-2 border-[#778DA9] text-[#778DA9] hover:text-[#E0E1DD] font-semibold py-3 sm:py-4 px-4 rounded-lg text-lg sm:text-xl w-full sm:w-1/3 transition duration-150 ease-in-out btn-focus">
                    Reset
                </button>
            </div>
        </div>

        <div id="breakTimerContent" class="timer-content" style="display: none;">
            <div id="breakTimeDisplay" class="text-6xl sm:text-8xl font-roboto-mono mb-10 sm:mb-12 text-center text-[#E0E1DD] py-4 bg-[#415A77]/30 rounded-lg">
                00:00:00
            </div>
            <div class="flex flex-col sm:flex-row justify-around space-y-4 sm:space-y-0 sm:space-x-4">
                <button id="breakStartButton" class="bg-[#415A77] hover:bg-[#5a768a] active:bg-[#354a60] text-[#E0E1DD] font-semibold py-3 sm:py-4 px-4 rounded-lg text-lg sm:text-xl w-full sm:w-1/3 transition duration-150 ease-in-out btn-focus">
                    Start
                </button>
                <button id="breakStopButton" class="bg-[#778DA9] hover:bg-[#93a5bd] active:bg-[#60738a] text-[#0D1B2A] font-semibold py-3 sm:py-4 px-4 rounded-lg text-lg sm:text-xl w-full sm:w-1/3 transition duration-150 ease-in-out btn-focus" disabled>
                    Stop
                </button>
                <button id="breakResetButton" class="bg-transparent hover:bg-[#415A77]/30 active:bg-[#415A77]/50 border-2 border-[#778DA9] text-[#778DA9] hover:text-[#E0E1DD] font-semibold py-3 sm:py-4 px-4 rounded-lg text-lg sm:text-xl w-full sm:w-1/3 transition duration-150 ease-in-out btn-focus">
                    Reset
                </button>
            </div>
        </div>
    </div>

    <script>
        // Timer State and DOM Elements Management
        let timers = {
            work: {
                startTime: undefined,
                tInterval: undefined,
                savedTime: 0,
                running: false,
                displayElement: document.getElementById('workTimeDisplay'),
                startButtonElement: document.getElementById('workStartButton'),
                stopButtonElement: document.getElementById('workStopButton'),
                resetButtonElement: document.getElementById('workResetButton'),
                contentElement: document.getElementById('workTimerContent'),
                tabButtonElement: document.getElementById('workTabButton'),
                lsKeys: {
                    savedTime: 'workTimerSavedTime',
                    startTime: 'workTimerStartTime',
                    running: 'workTimerRunning'
                }
            },
            break: {
                startTime: undefined,
                tInterval: undefined,
                savedTime: 0,
                running: false,
                displayElement: document.getElementById('breakTimeDisplay'),
                startButtonElement: document.getElementById('breakStartButton'),
                stopButtonElement: document.getElementById('breakStopButton'),
                resetButtonElement: document.getElementById('breakResetButton'),
                contentElement: document.getElementById('breakTimerContent'),
                tabButtonElement: document.getElementById('breakTabButton'),
                lsKeys: {
                    savedTime: 'breakTimerSavedTime',
                    startTime: 'breakTimerStartTime',
                    running: 'breakTimerRunning'
                }
            }
        };
        let activeTimerId = 'work'; // Default active timer
        const LS_ACTIVE_TAB = 'timerActiveTab';

        /**
         * Switches the active tab and timer view.
         */
        function switchTab(tabId) {
            if (!timers[tabId]) return;

            activeTimerId = tabId;
            localStorage.setItem(LS_ACTIVE_TAB, tabId);

            for (const id in timers) {
                const timer = timers[id];
                if (id === tabId) {
                    timer.contentElement.style.display = 'block';
                    timer.tabButtonElement.classList.add('active');
                } else {
                    timer.contentElement.style.display = 'none';
                    timer.tabButtonElement.classList.remove('active');
                }
                updateDisplay(id);
            }
        }

        /**
         * Load timer states and active tab from localStorage.
         */
        window.addEventListener('load', () => {
            const storedActiveTab = localStorage.getItem(LS_ACTIVE_TAB);
            if (storedActiveTab && timers[storedActiveTab]) {
                activeTimerId = storedActiveTab;
            }

            for (const timerId in timers) {
                const timer = timers[timerId];
                const storedSavedTime = localStorage.getItem(timer.lsKeys.savedTime);
                const storedStartTime = localStorage.getItem(timer.lsKeys.startTime);
                const storedRunning = localStorage.getItem(timer.lsKeys.running);

                if (storedSavedTime !== null) {
                    timer.savedTime = parseInt(storedSavedTime, 10);
                }

                if (storedRunning === 'true' && storedStartTime !== null) {
                    timer.startTime = parseInt(storedStartTime, 10);
                    timer.running = true;
                    
                    if (timer.tInterval) clearInterval(timer.tInterval);
                    timer.tInterval = setInterval(() => updateDisplay(timerId), 1000);
                    
                    timer.startButtonElement.disabled = true;
                    timer.stopButtonElement.disabled = false;
                    timer.resetButtonElement.disabled = false;
                } else {
                    timer.running = false;
                    timer.startButtonElement.disabled = false;
                    timer.stopButtonElement.disabled = true;
                }
                updateDisplay(timerId);
            }

            timers.work.tabButtonElement.addEventListener('click', () => switchTab('work'));
            timers.break.tabButtonElement.addEventListener('click', () => switchTab('break'));
            switchTab(activeTimerId);

            for (const timerId in timers) {
                const timer = timers[timerId];
                timer.startButtonElement.addEventListener('click', () => startTimer(timerId));
                timer.stopButtonElement.addEventListener('click', () => stopTimer(timerId));
                timer.resetButtonElement.addEventListener('click', () => resetTimer(timerId));
            }
        });

        /**
         * Starts or resumes the specified timer.
         * If the other timer is running, it will be stopped first.
         */
        function startTimer(timerIdToStart) {
            const timerToStart = timers[timerIdToStart];

            // Determine the other timer ID
            const otherTimerId = timerIdToStart === 'work' ? 'break' : 'work';
            const otherTimer = timers[otherTimerId];

            // If the other timer is running, stop it first
            if (otherTimer.running) {
                stopTimer(otherTimerId); // This will update its state, UI, and localStorage
            }

            // Now proceed to start the requested timer
            if (!timerToStart.running) {
                timerToStart.startTime = new Date().getTime();
                
                localStorage.setItem(timerToStart.lsKeys.startTime, timerToStart.startTime);
                localStorage.setItem(timerToStart.lsKeys.savedTime, timerToStart.savedTime);
                localStorage.setItem(timerToStart.lsKeys.running, 'true');

                if (timerToStart.tInterval) clearInterval(timerToStart.tInterval);
                timerToStart.tInterval = setInterval(() => updateDisplay(timerIdToStart), 1000); 
                timerToStart.running = true;

                timerToStart.startButtonElement.disabled = true;
                timerToStart.stopButtonElement.disabled = false;
                timerToStart.resetButtonElement.disabled = false; 
            }
        }

        /**
         * Stops or pauses the specified timer.
         */
        function stopTimer(timerId) {
            const timer = timers[timerId];
            if (timer.running) {
                clearInterval(timer.tInterval);
                timer.tInterval = null;
                timer.savedTime += (new Date().getTime() - timer.startTime);
                timer.running = false;

                localStorage.setItem(timer.lsKeys.savedTime, timer.savedTime);
                localStorage.setItem(timer.lsKeys.running, 'false');
                localStorage.removeItem(timer.lsKeys.startTime);

                timer.startButtonElement.disabled = false;
                timer.stopButtonElement.disabled = true;
                updateDisplay(timerId);
            }
        }

        /**
         * Resets the specified timer to zero.
         */
        function resetTimer(timerId) {
            const timer = timers[timerId];
            clearInterval(timer.tInterval);
            timer.tInterval = null; 
            timer.savedTime = 0;            ar
            timer.running = false;          
            timer.startTime = undefined;

            timer.displayElement.innerHTML = "00:00:00"; 

            localStorage.removeItem(timer.lsKeys.savedTime);
            localStorage.removeItem(timer.lsKeys.startTime);
            localStorage.removeItem(timer.lsKeys.running);

            timer.startButtonElement.disabled = false;
            timer.stopButtonElement.disabled = true; 
        }

        /**
         * Updates the time display for the specified timer.
         */
        function updateDisplay(timerId) {
            const timer = timers[timerId];
            if (!timer || !timer.displayElement) return;

            let difference;
            if (timer.running) {
                difference = (new Date().getTime() - timer.startTime) + timer.savedTime;
            } else {
                difference = timer.savedTime;
            }

            let hours = Math.floor((difference / (1000 * 60 * 60)) % 24);
            let minutes = Math.floor((difference / (1000 * 60)) % 60);
            let seconds = Math.floor((difference / 1000) % 60);

            hours = (hours < 10) ? "0" + hours : hours;
            minutes = (minutes < 10) ? "0" + minutes : minutes;
            seconds = (seconds < 10) ? "0" + seconds : seconds;
            
            timer.displayElement.innerHTML = `${hours}:${minutes}:${seconds}`;
        }
    </script>
</body>
</html>